{% comment %}
Bus Timetable Component
Usage:
{% include bus-timetable.html
title="Red vožnje"
stations=page.route_stations
start_station=page.start_station
end_station=page.end_station
station_times=page.station_times
%}

Where:
- stations is an array of station names
- start_station is the name of the starting station
- end_station is the name of the ending station
- station_times is a hash/map where each key is a station name and the value is an array of times

Example in page front matter:
---
route_stations:
- OMERBEGOVACA I
- Krajiševići
- Sisić Han
station_times:
OMERBEGOVACA I:
- 06:00
- 06:30
- 07:00
Krajiševići:
- 06:02
- 06:32
- 07:02
Sisić Han:
- 06:04
- 06:34
- 07:04
start_station: OMERBEGOVACA I
end_station: Maoča Centar
---
{% endcomment %}

<div class="card shadow-sm mb-4">
    <style>
        /* Service styles with increased specificity */
        table tbody tr td.irregular-service,
        table thead tr th.irregular-service {
            background-color: #ffe0e0 !important;
            color: #d32f2f !important;
        }

        table tbody tr td.regular-service,
        table thead tr th.regular-service {
            background-color: #e3f2fd !important;
            color: #1976d2 !important;
        }

        th.irregular-service {
            border-bottom: 2px solid #d32f2f !important;
        }

        th.regular-service {
            border-bottom: 2px solid #1976d2 !important;
        }

        /* Override table striping */
        .table-striped>tbody>tr:nth-of-type(odd)>td.irregular-service {
            background-color: #ffe0e0 !important;
        }

        .table-striped>tbody>tr:nth-of-type(odd)>td.regular-service {
            background-color: #e3f2fd !important;
        }

        /* Style for legend dots */
        .legend-dot {
            display: inline-block;
            width: 18px;
            height: 18px;
            line-height: 18px;
            text-align: center;
            border-radius: 50%;
            margin-right: 5px;
        }

        .regular-dot {
            color: #1976d2;
            background-color: #e3f2fd;
        }

        .irregular-dot {
            color: #d32f2f;
            background-color: #ffe0e0;
        }

        /* Style for R indicator */
        .station-r {
            display: inline-block;
            font-size: 0.75em;
            font-weight: bold;
            color: #ffffff;
            background-color: #f57c00;
            border-radius: 3px;
            padding: 0px 4px;
            margin-left: 2px;
            vertical-align: super;
        }

        /* Sticky first column styles */
        @media (max-width: 768px) {
            .table-responsive {
                position: relative;
            }

            .sticky-col {
                position: sticky;
                left: 0;
                z-index: 1;
                background-color: #fff;
                box-shadow: 2px 0 5px -2px rgba(0, 0, 0, 0.2);
            }

            .sticky-col.table-warning {
                background-color: #fff3cd !important;
                /* Match Bootstrap's warning color */
            }

            /* Fix the striping on odd rows */
            .table-striped>tbody>tr:nth-of-type(odd)>td.sticky-col {
                background-color: #f2f2f2 !important;
            }

            .table-striped>tbody>tr:nth-of-type(odd)>td.sticky-col.table-warning {
                background-color: #ffecb5 !important;
                /* Slightly darker warning for odd rows */
            }
        }
    </style>
    <div class="card-header bg-primary text-white">
        <div class="d-flex justify-content-between align-items-center">
            <h4 class="mb-0">{{ include.title | default: "Red vožnje" }}</h4>
            <span class="badge bg-light text-dark">Linija: {{ include.line_number | default: "8" }}</span>
        </div>
    </div>

    <!-- Route Map Visualization - Hidden on smaller screens -->
    {% if include.stations.size > 0 %}
    <div class="row mb-4 d-none d-xxl-block">
        <div class="col-12">
            {% include route-map.html
            title="Ruta linije"
            stations=include.stations
            start_station=include.start_station
            end_station=include.end_station
            %}
        </div>
    </div>
    {% endif %}
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-striped table-hover mb-0">
                <thead class="table-light">
                    <tr>
                        <th class="sticky-col">Stanica</th>
                        <th colspan="18">Vrijeme polaska</th>
                    </tr>
                    <tr>
                        <th class="sticky-col"></th> {% assign column_count = 0 %}
                        {% for time in include.station_times[include.start_station] %}
                        {% assign column_count = column_count | plus: 1 %}
                        {% assign column_string = column_count | string %}
                        {% if include.regular_services contains column_count %}
                        <th class="text-center small regular-service">{{ column_count }}</th>
                        {% else %}
                        <th class="text-center small irregular-service">{{ column_count }}</th>
                        {% endif %}
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for station in include.stations %} <tr {% if station==include.end_station %}class="table-warning"
                        {% endif %}>
                        <td class="sticky-col {% if station==include.end_station %}table-warning{% endif %}">
                            {% if station == include.start_station or station == include.end_station %}
                            <strong>{{ station | replace: ' "R"', ' <span class="station-r">R</span>' }}</strong>
                            {% else %}
                            {{ station | replace: ' "R"', ' <span class="station-r">R</span>' }}
                            {% endif %}
                        </td>{% if include.station_times and include.station_times[station] %} {% assign column_count =
                        0 %} {% for time in include.station_times[station] %}
                        {% assign column_count = column_count | plus: 1 %}
                        {% if include.regular_services contains column_count %}
                        <td class="regular-service">{% assign time_str = time | append: "" %}{{ time_str }}</td>
                        {% else %}
                        <td class="irregular-service">{% assign time_str = time | append: "" %}{{ time_str }}</td>
                        {% endif %}
                        {% endfor %}
                        {% else %}
                        <td>-</td>
                        {% endif %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <div class="card-footer">
        <div class="row">
            <div class="col-md-6">
                <h5>Objašnjenje</h5>
                <ul class="list-unstyled">
                    <li><small><span class="station-r">R</span> <strong>Raskrsnica</strong> - stanica na
                            raskrsnici</small></li>
                    <li><small><span class="legend-dot regular-dot">●</span> <strong>Plavo</strong> - {{
                            include.regular_explanation | default: "Polasci saobraćaju svakodnevno" }}</small></li>
                    <li><small><span class="legend-dot irregular-dot">●</span> <strong>Crveno</strong> - {{
                            include.irregular_explanation | default: "Ne saobraćaju vikendom, praznikom i tokom školskog
                            raspusta" }}</small></li>
                </ul>
            </div>
            <div class="col-md-6">
                <h5>Napomene</h5>
                <ul class="list-unstyled">
                    <li><small>Red vožnje važi od 01.09.2024.</small></li>
                </ul>
            </div>
        </div>
    </div>
</div>